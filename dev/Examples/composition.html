<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Composing Generators · Supposition.jl Documentation</title><meta name="title" content="Composing Generators · Supposition.jl Documentation"/><meta property="og:title" content="Composing Generators · Supposition.jl Documentation"/><meta property="twitter:title" content="Composing Generators · Supposition.jl Documentation"/><meta name="description" content="Documentation for Supposition.jl Documentation."/><meta property="og:description" content="Documentation for Supposition.jl Documentation."/><meta property="twitter:description" content="Documentation for Supposition.jl Documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Supposition.jl Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Main Page</a></li><li><a class="tocitem" href="../intro.html">Introduction to PBT</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="basic.html">Basic Usage</a></li><li class="is-active"><a class="tocitem" href="composition.html">Composing Generators</a><ul class="internal"><li><a class="tocitem" href="#@composed"><span><code>@composed</code></span></a></li><li><a class="tocitem" href="#Filtering,-mapping,-and-other-combinators"><span>Filtering, mapping, and other combinators</span></a></li></ul></li><li><a class="tocitem" href="docalignment.html">Alignment of Documentation</a></li><li><a class="tocitem" href="stateful.html">Stateful Testing</a></li></ul></li><li><a class="tocitem" href="../ressources.html">PBT Ressources</a></li><li><a class="tocitem" href="../faq.html">FAQ</a></li><li><a class="tocitem" href="../interfaces.html">Interfaces</a></li><li><a class="tocitem" href="../benchmarks.html">Benchmarks</a></li><li><a class="tocitem" href="../api.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="composition.html">Composing Generators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="composition.html">Composing Generators</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Composing-generators"><a class="docs-heading-anchor" href="#Composing-generators">Composing generators</a><a id="Composing-generators-1"></a><a class="docs-heading-anchor-permalink" href="#Composing-generators" title="Permalink"></a></h1><h2 id="@composed"><a class="docs-heading-anchor" href="#@composed"><code>@composed</code></a><a id="@composed-1"></a><a class="docs-heading-anchor-permalink" href="#@composed" title="Permalink"></a></h2><p>While Supposition.jl provides basic generators for a number of objects from Base, quite a lot of Julia code relies on the use of custom structs. At the innermost level, all Julia structs are composed of one or more of these basic types, like <code>Int</code>, <code>String</code>, <code>Vector</code> etc. Of course, we want to be able to generate &amp; correctly shrink these custom structs as well, so how can this be done? Enter <a href="../interfaces.html#Supposition.@composed"><code>@composed</code></a>, which can do exactly that. Here&#39;s how it&#39;s used:</p><pre><code class="language-julia hljs">using Supposition

const intgen = Data.Integers{Int}()

makeeven(x) = (x÷0x2)*0x2

gen = @composed function complex_even_Int(a=intgen, b=intgen)
    a = makeeven(a)
    b = makeeven(b)
    a + b*im
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.complex_even_Int{Complex{Int64}}()</code></pre><p>In essence, <code>@composed</code> takes a function that is given some generators, and ultimately returns a generator that runs the function on those given generators. As a full-fledged <code>Possibility</code>, you can of course do everything you&#39;d expect to do with other <code>Possibility</code> objects from Supposition.jl, including using them as input to other <code>@composed</code>! This makes them a powerful tool for composing custom generators.</p><pre><code class="language-julia hljs">@check function all_complex_even(c=gen)
    iseven(real(c)) &amp;&amp; iseven(imag(c))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Summary: | Pass  Total  Time
all_complex_even |    1      1  0.1s</code></pre><div class="admonition is-warning"><header class="admonition-header">Type stability</header><div class="admonition-body"><p>The inferred type of objects created by a generator from <code>@composed</code> is a <em>best effort</em> and may be wider than expected. E.g. if the input generators are non-<code>const</code> globals, it can easily happen that type inference falls back to <code>Any</code>. The same goes for other type instabilities and the usual best-practices surrounding type stability.</p></div></div><h2 id="Filtering,-mapping,-and-other-combinators"><a class="docs-heading-anchor" href="#Filtering,-mapping,-and-other-combinators">Filtering, mapping, and other combinators</a><a id="Filtering,-mapping,-and-other-combinators-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering,-mapping,-and-other-combinators" title="Permalink"></a></h2><h3 id="filter"><a class="docs-heading-anchor" href="#filter"><code>filter</code></a><a id="filter-1"></a><a class="docs-heading-anchor-permalink" href="#filter" title="Permalink"></a></h3><p>Of course, manually marking, mapping or filtering inside of <code>@composed</code> is sometimes a bit too much. For these cases, all <code>Possibility</code> support <code>filter</code> and <code>map</code>, returning a new <a href="../api.html#Supposition.Data.Satisfying"><code>Data.Satisfying</code></a> or <a href="../api.html#Supposition.Data.Map"><code>Data.Map</code></a> <code>Possibility</code> respectively:</p><pre><code class="language-julia hljs">using Supposition

intgen = Data.Integers{UInt8}()

f = filter(iseven, intgen)

example(f, 10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10-element Vector{UInt8}:
 0xce
 0x7e
 0xfc
 0x0a
 0x56
 0x12
 0x5c
 0x1e
 0x12
 0x9c</code></pre><p>Note that filtering is, in almost all cases, strictly worse than constructing the desired objects directly. For example, if the filtering predicate rejects too many examples from the input space, it can easily happen that no suitable examples can be found:</p><pre><code class="language-julia hljs">g = filter(&gt;(typemax(UInt8)), intgen)
example(g, 10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ERROR: Tried sampling 100000 times, without getting a result. Perhaps you&#39;re filtering out too many examples?</code></pre><p>It is best to only filter when you&#39;re certain that the part of the state space you&#39;re filtering out is not substantial.</p><h3 id="map"><a class="docs-heading-anchor" href="#map"><code>map</code></a><a id="map-1"></a><a class="docs-heading-anchor-permalink" href="#map" title="Permalink"></a></h3><p>In order to make it easier to directly construct conforming instances, you can use <code>map</code>, transforming the output of one <code>Possibility</code> into a different object:</p><pre><code class="language-julia hljs">using Supposition

intgen = Data.Integers{UInt8}()
makeeven(x) = (x÷0x2)*0x2
m = map(makeeven, intgen)

example(m, 10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10-element Vector{UInt8}:
 0x0e
 0x22
 0x86
 0x82
 0xc8
 0x62
 0x2e
 0x4a
 0x36
 0x7e</code></pre><div class="admonition is-warning"><header class="admonition-header">Type stability</header><div class="admonition-body"><p>The inferred type of objects created by a generator from <code>map</code> is a <em>best effort</em> and may be wider than expected. Ensure your function <code>f</code> is easily inferrable to have good chances for <code>map</code>ping it to be inferable as well.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="basic.html">« Basic Usage</a><a class="docs-footer-nextpage" href="docalignment.html">Alignment of Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 20 February 2024 19:56">Tuesday 20 February 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
